<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºèƒ½ç”µçƒ¤ç®± - ç®¡ç†å‘˜é¡µé¢</title>
    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('load', function() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (!isLoggedIn) {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
            }
        });
        
        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        }
        
        // ä¿®æ”¹å¯†ç åŠŸèƒ½
        function changePassword() {
            const newPassword = prompt('è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰:');
            if (newPassword && newPassword.length >= 8) {
                localStorage.setItem('adminPassword', newPassword);
                alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');
            } else if (newPassword) {
                alert('å¯†ç é•¿åº¦è‡³å°‘éœ€è¦8ä½ï¼');
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .status-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 24px;
            font-weight: 600;
        }

        .temperature {
            color: #ff6b6b;
        }

        .connected {
            color: #51cf66;
        }

        .control-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .control-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }

        .control-btn.primary {
            background: #10b981;
            color: white;
        }

        .control-btn.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .control-btn.tertiary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .admin-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .admin-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .admin-btn {
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .admin-btn.wifi {
            background: #3b82f6;
            color: white;
        }

        .admin-btn.restart {
            background: #f59e0b;
            color: white;
        }

        .admin-btn.reset {
            background: #ef4444;
            color: white;
        }

        .admin-btn:active {
            transform: scale(0.95);
        }

        .api-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .api-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .api-endpoints {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .api-endpoint {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            font-size: 12px;
            opacity: 0.7;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .logout-btn, .change-password-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover, .change-password-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .logout-btn:active, .change-password-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 480px) {
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-controls {
                flex-direction: column;
            }
            
            .control-btn {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ™ºèƒ½ç”µçƒ¤ç®±</h1>
            <p>ç®¡ç†å‘˜æ§åˆ¶é¢æ¿</p>
            <div class="admin-controls">
                <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
                <button class="change-password-btn" onclick="changePassword()">ä¿®æ”¹å¯†ç </button>
            </div>
        </div>

        <!-- è®¾å¤‡çŠ¶æ€ -->
        <div class="status-card">
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">å½“å‰æ¸©åº¦</div>
                    <div class="status-value temperature">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">ç›®æ ‡æ¸©åº¦</div>
                    <div class="status-value">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">åŠ çƒ­çŠ¶æ€</div>
                    <div class="status-value">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">WiFiçŠ¶æ€</div>
                    <div class="status-value connected">--</div>
                </div>
            </div>
        </div>

        <!-- åŸºç¡€æ§åˆ¶ -->
        <div class="control-section">
            <div class="quick-controls">
                <button class="control-btn primary" onclick="toggleHeating()">
                    <span>ğŸ”¥</span>
                    <span>å¯åŠ¨åŠ çƒ­</span>
                </button>
                <button class="control-btn secondary" onclick="quickSetTemp(180)">
                    <span>ğŸŒ¡ï¸</span>
                    <span>180Â°C</span>
                </button>
                <button class="control-btn tertiary" onclick="refreshData()">
                    <span>ğŸ”„</span>
                    <span>åˆ·æ–°</span>
                </button>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜åŠŸèƒ½ -->
        <div class="admin-section">
            <div class="admin-title">ç³»ç»Ÿç®¡ç†</div>
            <div class="admin-buttons">
                <button class="admin-btn wifi" onclick="window.location.href='wifi_config.html'">
                    <span>ğŸ“¶</span>
                    <span>WiFié…ç½®</span>
                </button>
                <button class="admin-btn restart" onclick="restartDevice()">
                    <span>ğŸ”„</span>
                    <span>é‡å¯è®¾å¤‡</span>
                </button>
                <button class="admin-btn reset" onclick="factoryReset()">
                    <span>âš ï¸</span>
                    <span>æ¢å¤å‡ºå‚è®¾ç½®</span>
                </button>
            </div>
        </div>

        <!-- APIç«¯ç‚¹ä¿¡æ¯ -->
        <div class="api-section">
            <div class="api-title">APIç«¯ç‚¹</div>
            <div class="api-endpoints">
                <div class="api-endpoint">GET /status - è·å–è®¾å¤‡çŠ¶æ€</div>
                <div class="api-endpoint">POST /control - æ§åˆ¶åŠ çƒ­å™¨</div>
                <div class="api-endpoint">POST /wificonfig - é…ç½®WiFi</div>
                <div class="api-endpoint">POST /restart - é‡å¯è®¾å¤‡</div>
                <div class="api-endpoint">POST /factoryreset - æ¢å¤å‡ºå‚è®¾ç½®</div>
            </div>
        </div>

        <div class="footer">
            <p>æ™ºèƒ½ç”µçƒ¤ç®±æ§åˆ¶å™¨ v0.5.0</p>
            <p>Â© 2025 æ™ºèƒ½ç”µçƒ¤ç®±é¡¹ç›®</p>
        </div>
    </div>
            <script>
        // è®¾å¤‡çŠ¶æ€å˜é‡
        let deviceStatus = {
            currentTemp: 0,
            targetTemp: 180,
            heatingEnabled: false,
            wifiConnected: false,
            wifiSSID: '',
            ipAddress: '',
            deviceId: '',
            firmwareVersion: ''
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ™ºèƒ½ç”µçƒ¤ç®±ç®¡ç†å‘˜é¡µé¢å·²åŠ è½½');
            refreshData();
            
            // æ¯5ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
            setInterval(refreshData, 5000);
        });

        // åˆ·æ–°è®¾å¤‡æ•°æ®
        async function refreshData() {
            try {
                const response = await fetch('/status');
                if (response.ok) {
                    const data = await response.json();
                    updateStatusDisplay(data);
                } else {
                    console.error('è·å–è®¾å¤‡çŠ¶æ€å¤±è´¥');
                    showDemoData();
                }
            } catch (error) {
                console.error('ç½‘ç»œè¿æ¥å¤±è´¥:', error);
                showDemoData();
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay(data) {
            deviceStatus = {
                currentTemp: data.temperature || 0,
                targetTemp: data.target_temperature || 180,
                heatingEnabled: data.heating_enabled || false,
                wifiConnected: data.wifi_connected || false,
                wifiSSID: data.wifiSSID || '',
                ipAddress: data.ip_address || '',
                deviceId: data.device_id || '',
                firmwareVersion: data.firmware_version || ''
            };

            // å®‰å…¨åœ°æ›´æ–°æ¸©åº¦æ˜¾ç¤º
            const statusItems = document.querySelectorAll('.status-item');
            if (statusItems.length >= 4) {
                statusItems[0].querySelector('.status-value').textContent = 
                    deviceStatus.currentTemp.toFixed(1) + 'Â°C';
                statusItems[1].querySelector('.status-value').textContent = 
                    deviceStatus.targetTemp.toFixed(1) + 'Â°C';
                
                // æ›´æ–°åŠ çƒ­çŠ¶æ€
                const heatingStatus = deviceStatus.heatingEnabled ? 'åŠ çƒ­ä¸­' : 'å·²åœæ­¢';
                statusItems[2].querySelector('.status-value').textContent = heatingStatus;
                statusItems[2].querySelector('.status-value').style.color = 
                    deviceStatus.heatingEnabled ? '#10b981' : '#6b7280';
                
                // æ›´æ–°WiFiçŠ¶æ€
                const wifiStatus = deviceStatus.wifiConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
                statusItems[3].querySelector('.status-value').textContent = wifiStatus;
                statusItems[3].querySelector('.status-value').style.color = 
                    deviceStatus.wifiConnected ? '#10b981' : '#ef4444';
            }
        }

        // æ˜¾ç¤ºæ¼”ç¤ºæ•°æ®ï¼ˆç½‘ç»œè¿æ¥å¤±è´¥æ—¶ï¼‰
        function showDemoData() {
            const demoData = {
                temperature: 25.5,
                target_temperature: 180,
                heating_enabled: false,
                wifi_connected: true,
                wifiSSID: 'SmartOven_AP',
                ip_address: '192.168.4.1',
                device_id: 'SmartOven_001',
                firmware_version: 'v1.0'
            };
            
            const connectionStatus = document.getElementById('connection-status');
            if (connectionStatus) {
                connectionStatus.textContent = 'æ¼”ç¤ºæ¨¡å¼';
                connectionStatus.style.color = '#f59e0b';
            }
            updateStatusDisplay(demoData);
        }

        // åˆ‡æ¢åŠ çƒ­çŠ¶æ€
        async function toggleHeating() {
            try {
                const response = await fetch('/control', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        heating_enabled: !deviceStatus.heatingEnabled
                    })
                });
                
                if (response.ok) {
                    refreshData();
                } else {
                    alert('æ§åˆ¶å‘½ä»¤å‘é€å¤±è´¥');
                }
            } catch (error) {
                console.error('æ§åˆ¶è®¾å¤‡å¤±è´¥:', error);
                alert('ç½‘ç»œè¿æ¥å¤±è´¥');
            }
        }

        // å¿«é€Ÿè®¾ç½®æ¸©åº¦
        async function quickSetTemp(temp) {
            try {
                const response = await fetch('/control', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        target_temperature: temp
                    })
                });
                
                if (response.ok) {
                    refreshData();
                } else {
                    alert('æ¸©åº¦è®¾ç½®å¤±è´¥');
                }
            } catch (error) {
                console.error('è®¾ç½®æ¸©åº¦å¤±è´¥:', error);
                alert('ç½‘ç»œè¿æ¥å¤±è´¥');
            }
        }

        // é‡å¯è®¾å¤‡
        async function restartDevice() {
            if (confirm('ç¡®å®šè¦é‡å¯è®¾å¤‡å—ï¼Ÿè®¾å¤‡å°†åœ¨5ç§’åé‡å¯ã€‚')) {
                try {
                    const response = await fetch('/restart', {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        alert('è®¾å¤‡é‡å¯å‘½ä»¤å·²å‘é€ï¼Œè¯·ç­‰å¾…çº¦30ç§’åé‡æ–°è¿æ¥');
                    } else {
                        alert('é‡å¯å‘½ä»¤å‘é€å¤±è´¥');
                    }
                } catch (error) {
                    console.error('é‡å¯è®¾å¤‡å¤±è´¥:', error);
                    alert('ç½‘ç»œè¿æ¥å¤±è´¥');
                }
            }
        }

        // æ¢å¤å‡ºå‚è®¾ç½®
        async function factoryReset() {
            if (confirm('ç¡®å®šè¦æ¢å¤å‡ºå‚è®¾ç½®å—ï¼Ÿæ‰€æœ‰é…ç½®å°†è¢«æ¸…é™¤ï¼Œè®¾å¤‡å°†é‡å¯ã€‚')) {
                try {
                    const response = await fetch('/factoryreset', {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        alert('æ¢å¤å‡ºå‚è®¾ç½®å‘½ä»¤å·²å‘é€ï¼Œè®¾å¤‡å°†é‡å¯å¹¶è¿›å…¥é…ç½‘æ¨¡å¼');
                    } else {
                        alert('æ¢å¤å‡ºå‚è®¾ç½®å‘½ä»¤å‘é€å¤±è´¥');
                    }
                } catch (error) {
                    console.error('æ¢å¤å‡ºå‚è®¾ç½®å¤±è´¥:', error);
                    alert('ç½‘ç»œè¿æ¥å¤±è´¥');
                }
            }
        }
    </script>
</body>
</html>
        </div>

        <!-- åŠŸèƒ½ç½‘æ ¼ -->
        <div class="feature-grid">
            <!-- æ¸©åº¦æ§åˆ¶ -->
            <div class="feature-card" onclick="openTemperatureControl()">
                <div class="feature-icon">ğŸŒ¡ï¸</div>
                <div class="feature-title">æ¸©åº¦æ§åˆ¶</div>
                <div class="feature-description">
                    ç²¾ç¡®æ§åˆ¶çƒ¤ç®±æ¸©åº¦ï¼Œè®¾ç½®ç›®æ ‡æ¸©åº¦ï¼Œç›‘æ§å®æ—¶æ¸©åº¦å˜åŒ–ï¼Œç¡®ä¿æœ€ä½³çƒ˜ç„™æ•ˆæœ
                </div>
                <div class="temperature-preview" id="temp-preview">
                    <small>å½“å‰: --Â°C | ç›®æ ‡: --Â°C</small>
                </div>
            </div>

            <!-- WiFié…ç½® -->
            <div class="feature-card" onclick="openWifiConfig()">
                <div class="feature-icon">ğŸ“¶</div>
                <div class="feature-title">WiFié…ç½®</div>
                <div class="feature-description">
                    ç®¡ç†è®¾å¤‡ç½‘ç»œè¿æ¥ï¼Œæ‰«æå¯ç”¨WiFiï¼Œé…ç½®ç½‘ç»œå‚æ•°ï¼Œç¡®ä¿è®¾å¤‡ç¨³å®šè”ç½‘
                </div>
                <div class="wifi-preview" id="wifi-preview">
                    <small>çŠ¶æ€: -- | ä¿¡å·: --</small>
                </div>
            </div>

            <!-- è®¾å¤‡çŠ¶æ€ -->
            <div class="feature-card" onclick="openDeviceStatus()">
                <div class="feature-icon">ğŸ“Š</div>
                <div class="feature-title">è®¾å¤‡çŠ¶æ€</div>
                <div class="feature-description">
                    æŸ¥çœ‹è®¾å¤‡è¯¦ç»†ä¿¡æ¯ï¼Œç›‘æ§ç³»ç»Ÿèµ„æºï¼Œåˆ†ææ¸©åº¦è¶‹åŠ¿ï¼Œå¯¼å‡ºè¿è¡Œæ•°æ®
                </div>
                <div class="status-preview" id="status-preview">
                    <small>å†…å­˜: -- | åŠ çƒ­: --</small>
                </div>
            </div>

            <!-- è®¾ç½®ä¸å¸®åŠ© -->
            <div class="feature-card" onclick="openSettingsHelp()">
                <div class="feature-icon">âš™ï¸</div>
                <div class="feature-title">è®¾ç½®ä¸å¸®åŠ©</div>
                <div class="feature-description">
                    ç³»ç»Ÿè®¾ç½®è°ƒæ•´ï¼Œè®¾å¤‡ç®¡ç†æ“ä½œï¼ŒæŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼Œè·å–æŠ€æœ¯æ”¯æŒ
                </div>
                <div class="settings-preview" id="settings-preview">
                    <small>å•ä½: Â°C | ç²¾åº¦: æ ‡å‡†</small>
                </div>
            </div>
        </div>


    </script>
</body>
</html>