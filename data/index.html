<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºèƒ½ç”µçƒ¤ç®± - ç®¡ç†å‘˜é¡µé¢</title>
    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('load', function() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (!isLoggedIn) {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
            }
        });
        
        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        }
        
        // ä¿®æ”¹å¯†ç åŠŸèƒ½
        function changePassword() {
            const newPassword = prompt('è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰:');
            if (newPassword && newPassword.length >= 8) {
                localStorage.setItem('adminPassword', newPassword);
                alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');
            } else if (newPassword) {
                alert('å¯†ç é•¿åº¦è‡³å°‘éœ€è¦8ä½ï¼');
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .logout-btn, .change-password-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .status-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 24px;
            font-weight: 600;
        }

        .temperature {
            color: #ff6b6b;
        }

        .connected {
            color: #51cf66;
        }

        .control-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .control-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }

        .control-btn.primary {
            background: #10b981;
            color: white;
        }

        .control-btn.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .admin-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .admin-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .admin-btn {
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .admin-btn.wifi {
            background: rgba(59, 130, 246, 0.2);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .admin-btn.restart {
            background: rgba(245, 158, 11, 0.2);
            color: white;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .admin-btn.reset {
            background: rgba(239, 68, 68, 0.2);
            color: white;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .api-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .api-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .api-endpoints {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .api-endpoint {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }

        .footer {
            text-align: center;
            padding: 20px;
            opacity: 0.7;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ™ºèƒ½ç”µçƒ¤ç®±</h1>
            <p>ç®¡ç†å‘˜æ§åˆ¶é¢æ¿</p>
            <div class="admin-controls">
                <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
                <button class="change-password-btn" onclick="changePassword()">ä¿®æ”¹å¯†ç </button>
            </div>
        </div>

        <!-- è®¾å¤‡çŠ¶æ€ -->
        <div class="status-card">
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">å½“å‰æ¸©åº¦</div>
                    <div class="status-value temperature">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">ç›®æ ‡æ¸©åº¦</div>
                    <div class="status-value">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">åŠ çƒ­çŠ¶æ€</div>
                    <div class="status-value">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">WiFiçŠ¶æ€</div>
                    <div class="status-value connected">--</div>
                </div>
            </div>
        </div>

        <!-- æ¸©åº¦æ§åˆ¶ -->
        <div class="control-section">
            <h3 style="text-align: center; margin-bottom: 20px; font-size: 20px;">æ¸©åº¦æ§åˆ¶</h3>
            
            <!-- æ¸©åº¦è°ƒæ•´æŒ‰é’® -->
            <div class="temp-controls" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;">
                <button class="temp-btn" onclick="changeTemp(-5)" style="background: rgba(255, 255, 255, 0.2); border: none; border-radius: 10px; padding: 15px; font-size: 18px; color: white; cursor: pointer;">-5Â°</button>
                <button class="temp-btn" onclick="changeTemp(-1)" style="background: rgba(255, 255, 255, 0.2); border: none; border-radius: 10px; padding: 15px; font-size: 18px; color: white; cursor: pointer;">-1Â°</button>
                <button class="temp-btn" onclick="changeTemp(1)" style="background: rgba(255, 255, 255, 0.2); border: none; border-radius: 10px; padding: 15px; font-size: 18px; color: white; cursor: pointer;">+1Â°</button>
                <button class="temp-btn" onclick="changeTemp(5)" style="background: rgba(255, 255, 255, 0.2); border: none; border-radius: 10px; padding: 15px; font-size: 18px; color: white; cursor: pointer;">+5Â°</button>
            </div>
            
            <!-- ç›´æ¥è®¾ç½®æ¸©åº¦ -->
            <div class="temp-input-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-size: 16px; font-weight: 500;">ç›´æ¥è®¾ç½®æ¸©åº¦ (Â°C)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="temp-input" style="flex: 1; padding: 15px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 10px; background: rgba(255, 255, 255, 0.1); color: white; font-size: 16px;" placeholder="è¾“å…¥ç›®æ ‡æ¸©åº¦" min="0" max="300" step="1">
                    <button onclick="setCustomTemp()" style="padding: 15px 20px; border: none; border-radius: 10px; background: #10b981; color: white; font-size: 16px; cursor: pointer;">è®¾ç½®</button>
                </div>
            </div>
            
            <!-- é¢„è®¾æ¸©åº¦ -->
            <div class="temp-presets" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                <button onclick="setPresetTemp(50)" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">50Â°C</button>
                <button onclick="setPresetTemp(100)" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">100Â°C</button>
                <button onclick="setPresetTemp(150)" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">150Â°C</button>
                <button onclick="setPresetTemp(180)" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">180Â°C</button>
                <button onclick="setPresetTemp(200)" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">200Â°C</button>
                <button onclick="setPresetTemp(250)" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">250Â°C</button>
            </div>
            
            <!-- åŸºç¡€æ§åˆ¶ -->
            <div class="quick-controls">
                <button class="control-btn primary" onclick="toggleHeating()">
                    <span>ğŸ”¥</span>
                    <span>å¯åŠ¨åŠ çƒ­</span>
                </button>
                <button class="control-btn secondary" onclick="refreshData()">
                    <span>ğŸ”„</span>
                    <span>åˆ·æ–°</span>
                </button>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜åŠŸèƒ½ -->
        <div class="admin-section">
            <div class="admin-title">ç³»ç»Ÿç®¡ç†</div>
            <div class="admin-buttons">
                <button class="admin-btn wifi" onclick="window.location.href='wifi_config.html'">
                    <span>ğŸ“¶</span>
                    <span>WiFié…ç½®</span>
                </button>
                <button class="admin-btn restart" onclick="restartDevice()">
                    <span>ğŸ”„</span>
                    <span>é‡å¯è®¾å¤‡</span>
                </button>
                <button class="admin-btn reset" onclick="factoryReset()">
                    <span>âš ï¸</span>
                    <span>æ¢å¤å‡ºå‚è®¾ç½®</span>
                </button>
            </div>
        </div>

        <!-- APIç«¯ç‚¹ä¿¡æ¯ -->
        <div class="api-section">
            <div class="api-title">APIç«¯ç‚¹</div>
            <div class="api-endpoints">
                <div class="api-endpoint">GET /status - è·å–è®¾å¤‡çŠ¶æ€</div>
                <div class="api-endpoint">POST /control - æ§åˆ¶åŠ çƒ­å™¨</div>
                <div class="api-endpoint">POST /wificonfig - é…ç½®WiFi</div>
                <div class="api-endpoint">POST /restart - é‡å¯è®¾å¤‡</div>
                <div class="api-endpoint">POST /factoryreset - æ¢å¤å‡ºå‚è®¾ç½®</div>
            </div>
        </div>

        <div class="footer">
            <p>æ™ºèƒ½ç”µçƒ¤ç®±æ§åˆ¶å™¨ v0.6.0</p>
            <p>Â© 2025 æ™ºèƒ½ç”µçƒ¤ç®±é¡¹ç›®</p>
        </div>
    </div>

    <script>
        // è®¾å¤‡çŠ¶æ€å˜é‡
        let deviceStatus = {
            currentTemp: 0,
            targetTemp: 180,
            heatingEnabled: false,
            wifiConnected: false,
            wifiSSID: '',
            ipAddress: '',
            deviceId: '',
            firmwareVersion: ''
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ™ºèƒ½ç”µçƒ¤ç®±ç®¡ç†å‘˜é¡µé¢å·²åŠ è½½');
            refreshData();
            
            // æ¯5ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
            setInterval(refreshData, 5000);
        });

        // åˆ·æ–°è®¾å¤‡æ•°æ®
        async function refreshData() {
            try {
                const response = await fetch('/status');
                if (response.ok) {
                    const data = await response.json();
                    updateStatusDisplay(data);
                } else {
                    console.error('è·å–è®¾å¤‡çŠ¶æ€å¤±è´¥');
                    showDemoData();
                }
            } catch (error) {
                console.error('ç½‘ç»œè¿æ¥å¤±è´¥:', error);
                showDemoData();
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay(data) {
            deviceStatus = {
                currentTemp: data.temperature || 0,
                targetTemp: data.target_temperature || 180,
                heatingEnabled: data.heating_enabled || false,
                wifiConnected: data.wifi_connected || false,
                wifiSSID: data.wifiSSID || '',
                ipAddress: data.ip_address || '',
                deviceId: data.device_id || '',
                firmwareVersion: data.firmware_version || ''
            };

            // å®‰å…¨åœ°æ›´æ–°æ¸©åº¦æ˜¾ç¤º
            const statusItems = document.querySelectorAll('.status-item');
            if (statusItems.length >= 4) {
                statusItems[0].querySelector('.status-value').textContent = 
                    deviceStatus.currentTemp.toFixed(1) + 'Â°C';
                statusItems[1].querySelector('.status-value').textContent = 
                    deviceStatus.targetTemp.toFixed(1) + 'Â°C';
                
                // æ›´æ–°åŠ çƒ­çŠ¶æ€
                const heatingStatus = deviceStatus.heatingEnabled ? 'åŠ çƒ­ä¸­' : 'å·²åœæ­¢';
                statusItems[2].querySelector('.status-value').textContent = heatingStatus;
                statusItems[2].querySelector('.status-value').style.color = 
                    deviceStatus.heatingEnabled ? '#10b981' : '#6b7280';
                
                // æ›´æ–°WiFiçŠ¶æ€
                const wifiStatus = deviceStatus.wifiConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
                statusItems[3].querySelector('.status-value').textContent = wifiStatus;
                statusItems[3].querySelector('.status-value').style.color = 
                    deviceStatus.wifiConnected ? '#10b981' : '#ef4444';
            }
        }

        // æ˜¾ç¤ºæ¼”ç¤ºæ•°æ®ï¼ˆç½‘ç»œè¿æ¥å¤±è´¥æ—¶ï¼‰
        function showDemoData() {
            const demoData = {
                temperature: 25.5,
                target_temperature: 180,
                heating_enabled: false,
                wifi_connected: true,
                wifiSSID: 'SmartOven_AP',
                ip_address: '192.168.4.1',
                device_id: 'SmartOven_001',
                firmware_version: 'v1.0'
            };
            
            const connectionStatus = document.getElementById('connection-status');
            if (connectionStatus) {
                connectionStatus.textContent = 'æ¼”ç¤ºæ¨¡å¼';
                connectionStatus.style.color = '#f59e0b';
            }
            updateStatusDisplay(demoData);
        }

        // åˆ‡æ¢åŠ çƒ­çŠ¶æ€
        async function toggleHeating() {
            try {
                const response = await fetch('/control', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        heating_enabled: !deviceStatus.heatingEnabled
                    })
                });
                
                if (response.ok) {
                    refreshData();
                } else {
                    alert('æ§åˆ¶å‘½ä»¤å‘é€å¤±è´¥');
                }
            } catch (error) {
                console.error('æ§åˆ¶è®¾å¤‡å¤±è´¥:', error);
                alert('ç½‘ç»œè¿æ¥å¤±è´¥');
            }
        }

        // æ¸©åº¦è°ƒæ•´å‡½æ•°
        function changeTemp(delta) {
            const newTemp = Math.max(0, Math.min(300, deviceStatus.targetTemp + delta));
            setTargetTemp(newTemp);
        }

        // è®¾ç½®é¢„è®¾æ¸©åº¦
        function setPresetTemp(temp) {
            setTargetTemp(temp);
        }

        // è®¾ç½®è‡ªå®šä¹‰æ¸©åº¦
        function setCustomTemp() {
            const input = document.getElementById('temp-input');
            const temp = parseInt(input.value);
            if (!isNaN(temp) && temp >= 0 && temp <= 300) {
                setTargetTemp(temp);
                input.value = '';
            } else {
                alert('è¯·è¾“å…¥0-300Â°Cä¹‹é—´çš„æœ‰æ•ˆæ¸©åº¦å€¼');
            }
        }

        // è®¾ç½®ç›®æ ‡æ¸©åº¦
        async function setTargetTemp(temp) {
            try {
                const response = await fetch('/control', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        target_temperature: temp
                    })
                });
                
                if (response.ok) {
                    deviceStatus.targetTemp = temp;
                    refreshData();
                } else {
                    alert('æ¸©åº¦è®¾ç½®å¤±è´¥');
                }
            } catch (error) {
                console.error('è®¾ç½®æ¸©åº¦å¤±è´¥:', error);
                alert('ç½‘ç»œè¿æ¥å¤±è´¥');
            }
        }

        // é‡å¯è®¾å¤‡
        async function restartDevice() {
            if (confirm('ç¡®å®šè¦é‡å¯è®¾å¤‡å—ï¼Ÿè®¾å¤‡å°†åœ¨5ç§’åé‡å¯ã€‚')) {
                try {
                    const response = await fetch('/restart', {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        alert('è®¾å¤‡é‡å¯å‘½ä»¤å·²å‘é€ï¼Œè¯·ç­‰å¾…çº¦30ç§’åé‡æ–°è¿æ¥');
                    } else {
                        alert('é‡å¯å‘½ä»¤å‘é€å¤±è´¥');
                    }
                } catch (error) {
                    console.error('é‡å¯è®¾å¤‡å¤±è´¥:', error);
                    alert('ç½‘ç»œè¿æ¥å¤±è´¥');
                }
            }
        }

        // æ¢å¤å‡ºå‚è®¾ç½®
        async function factoryReset() {
            if (confirm('ç¡®å®šè¦æ¢å¤å‡ºå‚è®¾ç½®å—ï¼Ÿæ‰€æœ‰é…ç½®å°†è¢«æ¸…é™¤ï¼Œè®¾å¤‡å°†é‡å¯ã€‚')) {
                try {
                    const response = await fetch('/factoryreset', {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        alert('æ¢å¤å‡ºå‚è®¾ç½®å‘½ä»¤å·²å‘é€ï¼Œè®¾å¤‡å°†é‡å¯å¹¶è¿›å…¥é…ç½‘æ¨¡å¼');
                    } else {
                        alert('æ¢å¤å‡ºå‚è®¾ç½®å‘½ä»¤å‘é€å¤±è´¥');
                    }
                } catch (error) {
                    console.error('æ¢å¤å‡ºå‚è®¾ç½®å¤±è´¥:', error);
                    alert('ç½‘ç»œè¿æ¥å¤±è´¥');
                }
            }
        }
    </script>
</body>
</html>