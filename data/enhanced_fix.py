#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
增强版修复脚本
处理以下问题：
1. 修复lang.js文件中的乱码问题
2. 替换index.html中的硬编码中文为data-lang属性
3. 更新lang.js中的翻译键
"""

import os
import re
import json

# 项目路径
PROJECT_DIR = os.path.dirname(os.path.abspath(__file__))
INDEX_HTML_PATH = os.path.join(PROJECT_DIR, 'index.html')
LANG_JS_PATH = os.path.join(PROJECT_DIR, 'lang.js')
CHINESE_STRINGS_PATH = os.path.join(PROJECT_DIR, 'chinese_strings_new.txt')

# 增强的乱码映射字典
GARBLED_MAPPINGS = {
    # 控制命令发送失败的各种乱码形式
    'æ§åˆ¶å‘½ä»¤å‘é€å¤±è´¥': '控制命令发送失败',
    'æ§制命令å‘é€失败': '控制命令发送失败',
    'æ§制å‘½ä»¤å‘é€失败': '控制命令发送失败',
    'Ã¦ï¿½Â§Ã¥ËÂ¶Ã¥âÂ½Ã¤Â»Â¤Ã¥ï¿½âÃ©âï¿½失败': '控制命令发送失败',
    'æ§åˆ¶å‘½ä»¤å‘é€å¤±è´¥': '控制命令发送失败',
    'æ§制命令å‘é€失败': '控制命令发送失败',
    'æ§制å‘½ä»¤å‘é€失败': '控制命令发送失败',
    'æ§制命令å‘é€失败': '控制命令发送失败',
    'æ§å‘½ä»¤å‘é€å¤±è´¥': '控制命令发送失败',
    
    # 网络连接失败的各种乱码形式
    'ç½‘ç»œè¿æ¥å¤±è´¥': '网络连接失败',
    '网络è¿æ¥失败': '网络连接失败',
    'ç½ç»Ã¨Â¿ï¿½Ã¦ï¿½Â¥失败': '网络连接失败',
    'ç½‘ç»œè¿æ¥å¤±è´¥': '网络连接失败',
    '网络è¿æ¥失败': '网络连接失败',
    'ç½‘ç»œè¿žæŽ¥å¤±è´¥': '网络连接失败',
    
    # 设备状态获取失败的乱码形式
    'è·å–设备状态保¡æ¯': '获取设备状态信息失败',
    'è»å–è®¾å¤‡çŠ¶æ€ä¿¡æ¯': '获取设备状态信息失败',
    'è»å–è®¾å¤‡çŠ¶æ¯ä¿¡æ¯': '获取设备状态信息失败',
    'è·å–设备状态失败': '获取设备状态信息失败',
    
    # 烘烤时间的乱码形式
    'çƒ˜ç„™时间 (分钟)': '烘烤时间 (分钟)',
    'çƒ˜ç„™æ—¶é—´ (åˆ†é’Ÿ)': '烘烤时间 (分钟)',
    
    # 密码修改成功的乱码形式
    'å¯†ç ä¿®æ”¹æˆåŠŸ': '密码修改成功',
    'å¯†ç ä¿®æ”¹æˆåŠŸï¼': '密码修改成功！',
    
    # 温度范围错误的乱码形式
    'æ¸©åº¦èŒƒå›´åº”ä¸º 50-250Â°C': '温度范围应为 50-250°C',
    
    # 重启设备确认的乱码形式
    'ç¡®å®šè¦é‡å¯è®¾å¤‡å—?': '确定要重启设备吗?',
    
    # 恢复出厂设置确认的乱码形式
    'ç¡®å®šè¦æ¢å¤å‡ºåŽ‚è®¾ç½®å—?': '确定要恢复出厂设置吗?',
    
    # 退出登录失败的乱码形式
    'é€€å‡ºç™»å½•å¤±è´¥': '退出登录失败',
    
    # 显示手动模式部分的乱码形式
    'æ˜¾ç¤ºæ‰‹åŠ¨æ¨¡å¼éƒ¨åˆ†': '显示手动模式部分',
    'æ˜¾ç¤ºå®é™…æ¨¡å¼éƒ¨åˆ†': '显示手动模式部分',
    
    # 显示自动模式部分的乱码形式
    'æ˜¾ç¤ºè‡ªåŠ¨æ¨¡å¼éƒ¨åˆ†': '显示自动模式部分',
    'æ˜¾ç¤ºå®é™…æ¨¡å¼éƒ¨åˆ†': '显示自动模式部分',
    
    # 加热控制的乱码形式
    'å¼€å§‹åŠ çƒ­': '开启加热',
    'åœæ­¢åŠ çƒ­': '停止加热',
    
    # 非零值的乱码形式
    'éžé›¶å€¼': '非零值',
    
    # 确定按钮的乱码形式
    'ç¡®å®š': '确定',
    
    # 取消按钮的乱码形式
    'å–æ¶ˆ': '取消',
    
    # 检测到警告的乱码形式
    'æ£€æµ‹åˆ°è­¦å‘Š': '检测到警告',
    
    # 新增的乱码映射
    'æ¢复出å‚设置命令å‘é€失败': '恢复出厂设置命令发送失败',
    'è®¾å¤‡æ­£åœ¨é‡å¯': '设备正在重启',
    'è®¾å¤‡å·²æ¢å¤å‡ºåŽ‚è®¾ç½®': '设备已恢复出厂设置',
    'è®¾å¤‡é‡å¯å‘½ä»¤å·²å‘é€': '设备重启命令已发送',
    'è®¾å¤‡é‡å¯å‘½ä»¤å·²å‘é€ï¼Œè¯·ç­‰å¾…çº¦30ç§’åŽé‡æ–°è¿žæŽ¥': '设备重启命令已发送，请等待约30秒后重新连接',
    'è®¾å¤‡æ­£åœ¨é‡å¯ï¼Œè¯·ç­‰å¾…å‡åˆ†é’ŸåŽé‡æ–°è¿žæŽ¥ã€‚': '设备正在重启，请等待几分钟后重新连接。',
    'è®¾å¤‡çŠ¶æ€ä¿¡æ¯': '设备状态信息',
    'è®¾å¤‡çŠ¶æ€èŽ·å–å¤±è´¥': '设备状态获取失败',
    'æ¸©åº¦çŠ¶æ€': '温度状态',
    'åŠ çƒ­çŠ¶æ€': '加热状态',
    'è®¾å¤‡çŠ¶æ€èŽ·å–å¤±è´¥': '设备状态获取失败',
    'ç»è®¡æ•°æ®': '统计数据',
    'å½“å‰æ¸©åº¦': '当前温度',
    'è®¾å¤‡æŽ§åˆ¶': '设备控制',
    'è®¾å¤‡è®¾ç½®': '设备设置',
    'ç³»ç»Ÿä¿¡æ¯': '系统信息',
    'è¿žæŽ¥çŠ¶æ€': '连接状态',
    'ç½‘ç»œè¿žæŽ¥çŠ¶æ€': '网络连接状态',
    'è®¾å¤‡è¿žæŽ¥çŠ¶æ€': '设备连接状态',
    'è®¾å¤‡è¿žæŽ¥å¤±è´¥': '设备连接失败',
    'è®¾å¤‡è¿žæŽ¥æˆåŠŸ': '设备连接成功',
    'è®¾å¤‡è¿žæŽ¥è¶…æ—¶': '设备连接超时',
    'è®¾å¤‡è¿žæŽ¥æ­£åœ¨è¿›è¡Œ': '设备连接正在进行',
    'è®¾å¤‡è¿žæŽ¥å¼‚å¸¸': '设备连接异常',
    'è®¾å¤‡è¿žæŽ¥æ–­å¼€': '设备连接断开',
    'è®¾å¤‡è¿žæŽ¥æœªçŸ¥é”™è¯¯': '设备连接未知错误',
    'è®¾å¤‡è¿žæŽ¥é”™è¯¯': '设备连接错误',
    'è®¾å¤‡è¿žæŽ¥å¤±è´¥ï¼Œè¯·é‡è¯•': '设备连接失败，请重试',
    'è®¾å¤‡è¿žæŽ¥æˆåŠŸï¼Œå¼€å§‹æŽ¥æ”¶æ•°æ®': '设备连接成功，开始接收数据',
    'è®¾å¤‡è¿žæŽ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ': '设备连接超时，请检查网络',
    'è®¾å¤‡è¿žæŽ¥æ­£åœ¨è¿›è¡Œï¼Œè¯·ç¨å€™': '设备连接正在进行，请稍候',
    'è®¾å¤‡è¿žæŽ¥å¼‚å¸¸ï¼Œè¯·é‡å¯è®¾å¤‡': '设备连接异常，请重启设备',
    'è®¾å¤‡è¿žæŽ¥æ–­å¼€ï¼Œè¯·é‡æ–°è¿žæŽ¥': '设备连接断开，请重新连接',
    'è®¾å¤‡è¿žæŽ¥æœªçŸ¥é”™è¯¯ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ': '设备连接未知错误，请联系技术支持',
    'è®¾å¤‡è¿žæŽ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥è®¾å¤‡åœ°å€': '设备连接错误，请检查设备地址',
    'è®¾å¤‡è¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥WiFiå¯†ç ': '设备连接失败，请检查WiFi密码',
    'è®¾å¤‡è¿žæŽ¥æˆåŠŸï¼Œå¼€å§‹æŽ¥æ”¶æ•°æ®ï¼Œè¯·ç­‰å¾…': '设备连接成功，开始接收数据，请等待',
    'è®¾å¤‡è¿žæŽ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥è®¾å¤‡æ˜¯å¦åœ¨çº¿': '设备连接超时，请检查设备是否在线',
    'è®¾å¤‡è¿žæŽ¥æ­£åœ¨è¿›è¡Œï¼Œè¯·ç¡®ä¿è®¾å¤‡å·²å¼€æœº': '设备连接正在进行，请确认设备已开机',
    'è®¾å¤‡è¿žæŽ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥è®¾å¤‡å›ºä»¶ç‰ˆæœ¬': '设备连接异常，请检查设备固件版本',
    'è®¾å¤‡è¿žæŽ¥æ–­å¼€ï¼Œè¯·æ£€æŸ¥è®¾å¤‡ç”µæº': '设备连接断开，请检查设备电源',
    'è®¾å¤‡è¿žæŽ¥æœªçŸ¥é”™è¯¯ï¼Œè¯·å°æ—¶åŽé‡è¯•': '设备连接未知错误，请稍后重试',
    'è®¾å¤‡è¿žæŽ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥è®¾å¤‡IPåœ°å€': '设备连接错误，请检查设备IP地址',
    
    # 更多乱码映射
    '数据自动化': '数据自动化',
    '加热器已关闭': '加热器已关闭',
    '更新æ\xa0¡å‡†显示': '更新校准显示',
    '清除ï¼Œ设备å°†重å¯å¹¶æ¢复出å‚状态ã€‚': '清除历史记录，设备将重启并恢复出厂状态。',
    '请输入值': '请输入值',
    '输入超出范围': '输入超出范围',
    '时间范围应为': '时间范围应为',
    '自动模式设置': '自动模式设置',
    '最后刷新时间': '最后刷新时间',
    '数据架构': '数据架构',
    '系统监控': '系统监控',
    'è®¾å¤‡å·²æ¢复å‡ºåŽ‚è®¾ç½®': '设备已恢复出厂设置',
    'è®¾å¤‡å¯å§‹åŒ–å¤±è´¥': '设备初始化失败',
    'è®¾å¤‡æ­£åœ¨å¯å§‹åŒ–': '设备正在初始化',
    'è®¾å¤‡å¯å§‹åŒ–æˆåŠŸ': '设备初始化成功',
    'è®¾å¤‡å¯å§‹åŒ–è¶…æ—¶': '设备初始化超时',
    'è®¾å¤‡å¯å§‹åŒ–å¼‚å¸¸': '设备初始化异常',
    'è®¾å¤‡å¯å§‹åŒ–è¢«ä¸­æ–­': '设备初始化被中断',
    'è®¾å¤‡å¯å§‹åŒ–æœªå®Œæˆ': '设备初始化未完成',
    'è®¾å¤‡å¯å§‹åŒ–éœ€è¦æ‰‹åŠ¨å¹²é¢„': '设备初始化需要手动干预',
    'è®¾å¤‡å¯å§‹åŒ–æœªå¼€å§‹': '设备初始化未开始',
    'è®¾å¤‡å¯å§‹åŒ–å·²å®Œæˆ': '设备初始化已完成',
    'è®¾å¤‡å¯å§‹åŒ–è¿›åº¦': '设备初始化进度',
    'è®¾å¤‡å¯å§‹åŒ–çŠ¶æ€': '设备初始化状态',
    'è®¾å¤‡å¯å§‹åŒ–è¯¦ç»†ä¿¡æ¯': '设备初始化详细信息',
    'è®¾å¤‡å¯å§‹åŒ–ç»“æžœ': '设备初始化结果',
    'è®¾å¤‡å¯å§‹åŒ–æ—¥å¿—': '设备初始化日志',
    'è®¾å¤‡å¯å§‹åŒ–é”™è¯¯': '设备初始化错误',
    'è®¾å¤‡å¯å§‹åŒ–è­¦å‘Š': '设备初始化警告',
    'è®¾å¤‡å¯å§‹åŒ–æç¤º': '设备初始化提示',
    'è®¾å¤‡å¯å§‹åŒ–æŒ‡å—': '设备初始化指南',
    'è®¾å¤‡å¯å§‹åŒ–è¯´æ˜Ž': '设备初始化说明',
    'è®¾å¤‡å¯å§‹åŒ–æ–¹æ¡ˆ': '设备初始化方案',
    'è®¾å¤‡å¯å§‹åŒ–æ­¥éª¤': '设备初始化步骤',
    'è®¾å¤‡å¯å§‹åŒ–æµç¨‹': '设备初始化流程',
    'è®¾å¤‡å¯å§‹åŒ–è®¡åˆ': '设备初始化计划',
    'è®¾å¤‡å¯å§‹åŒ–å®‰å…¨æ€§': '设备初始化安全性',
    'è®¾å¤‡å¯å§‹åŒ–å¯é æ€§': '设备初始化可靠性',
    'è®¾å¤‡å¯å§‹åŒ–æ•ˆçŽ‡': '设备初始化效率',
    'è®¾å¤‡å¯å§‹åŒ–è´¨é‡': '设备初始化质量',
    'è®¾å¤‡å¯å§‹åŒ–æ€§èƒ½': '设备初始化性能',
    'è®¾å¤‡å¯å§‹åŒ–é€Ÿåº¦': '设备初始化速度',
    'è®¾å¤‡å¯å§‹åŒ–è€—æ—¶': '设备初始化耗时',
    'è®¾å¤‡å¯å§‹åŒ–èµ„æº': '设备初始化资源',
    'è®¾å¤‡å¯å§‹åŒ–é…ç½®': '设备初始化配置',
    'è®¾å¤‡å¯å§‹åŒ–å‚æ•°': '设备初始化参数',
    'è®¾å¤‡å¯å§‹åŒ–è¾“å…¥': '设备初始化输入',
    'è®¾å¤‡å¯å§‹åŒ–è¾“å‡º': '设备初始化输出',
    'è®¾å¤‡å¯å§‹åŒ–è¿”å›žå€¼': '设备初始化返回值',
    'è®¾å¤‡å¯å§‹åŒ–ç»“æžœä»£ç ': '设备初始化结果代码',
    'è®¾å¤‡å¯å§‹åŒ–çŠ¶æ€ä»£ç ': '设备初始化状态代码',
    'è®¾å¤‡å¯å§‹åŒ–é”™è¯¯ä»£ç ': '设备初始化错误代码',
    'è®¾å¤‡å¯å§‹åŒ–è­¦å‘Šä»£ç ': '设备初始化警告代码',
    'è®¾å¤‡å¯å§‹åŒ–æç¤ºä»£ç ': '设备初始化提示代码',
    'è®¾å¤‡å¯å§‹åŒ–æ•°æ®': '设备初始化数据',
    'è®¾å¤‡å¯å§‹åŒ–æ–‡ä»¶': '设备初始化文件',
    'è®¾å¤‡å¯å§‹åŒ–è·¯å¾„': '设备初始化路径',
    'è®¾å¤‡å¯å§‹åŒ–ç›®å½•': '设备初始化目录',
    'è®¾å¤‡å¯å§‹åŒ–è¿›ç¨‹': '设备初始化进程',
    'è®¾å¤‡å¯å§‹åŒ–çº¿ç¨‹': '设备初始化线程',
    'è®¾å¤‡å¯å§‹åŒ–ä»»åŠ¡': '设备初始化任务',
    'è®¾å¤‡å¯å§‹åŒ–äº‹ä»¶': '设备初始化事件',
    'è®¾å¤‡å¯å§‹åŒ–å›žè°ƒ': '设备初始化回调',
    'è®¾å¤‡å¯å§‹åŒ–é’©å­': '设备初始化钩子',
    'è®¾å¤‡å¯å§‹åŒ–æ‹¦æˆªå™¨': '设备初始化拦截器',
    'è®¾å¤‡å¯å§‹åŒ–è¿‡æ»¤å™¨': '设备初始化过滤器',
    'è®¾å¤‡å¯å§‹åŒ–æŽ§åˆ¶å™¨': '设备初始化控制器',
    'è®¾å¤‡å¯å§‹åŒ–è§†å›¾': '设备初始化视图',
    'è®¾å¤‡å¯å§‹åŒ–æ¨¡åž‹': '设备初始化模型',
    'è®¾å¤‡å¯å§‹åŒ–æ¨¡å¼': '设备初始化模式',
    'è®¾å¤‡å¯å§‹åŒ–æ¨¡å¿': '设备初始化模块',
    'è®¾å¤‡å¯å§‹åŒ–ç»„ä»¶': '设备初始化组件',
    'è®¾å¤‡å¯å§‹åŒ–æœåŠ¡': '设备初始化服务',
    'è®¾å¤‡å¯å§‹åŒ–æŽ¥å£': '设备初始化接口',
    'è®¾å¤‡å¯å§‹åŒ–å®žçŽ°': '设备初始化实现',
    'è®¾å¤‡å¯å§‹åŒ–æŠ½è±¡': '设备初始化抽象',
    'è®¾å¤‡å¯å§‹åŒ–ç»§æ‰¿': '设备初始化继承',
    'è®¾å¤‡å¯å§‹åŒ–å¤šæ€': '设备初始化多态',
    'è®¾å¤‡å¯å§‹åŒ–å°è£…': '设备初始化封装',
    'è®¾å¤‡å¯å§‹åŒ–é‡è½½': '设备初始化重载',
    'è®¾å¤‡å¯å§‹åŒ–è¦†ç›–': '设备初始化覆盖',
    'è®¾å¤‡å¯å§‹åŒ–æ‹“å±•': '设备初始化拓展',
    'è®¾å¤‡å¯å§‹åŒ–æ··åˆ': '设备初始化融合',
    'è®¾å¤‡å¯å§‹åŒ–èšåˆ': '设备初始化聚合',
    'è®¾å¤‡å¯å§‹åŒ–ç»„åˆ': '设备初始化组合',
    'è®¾å¤‡å¯å§‹åŒ–äº¤äº’': '设备初始化交互',
    'è®¾å¤‡å¯å§‹åŒ–é€šä¿¡': '设备初始化通信',
    'è®¾å¤‡å¯å§‹åŒ–åŒæ­¥': '设备初始化同步',
    'è®¾å¤‡å¯å§‹åŒ–å¼‚æ­¥': '设备初始化异步',
    'è®¾å¤‡å¯å§‹åŒ–å¹¶å‘': '设备初始化并发',
    'è®¾å¤‡å¯å§‹åŒ–å¹¶è¡Œ': '设备初始化并行',
    'è®¾å¤‡å¯å§‹åŒ–ä¸²è¡Œ': '设备初始化串行',
    'è®¾å¤‡å¯å§‹åŒ–é˜»å¡ž': '设备初始化阻塞',
    'è®¾å¤‡å¯å§‹åŒ–éžé˜»å¡ž': '设备初始化非阻塞',
    'è®¾å¤‡å¯å§‹åŒ–å®šæ—¶': '设备初始化定时',
    'è®¾å¤‡å¯å§‹åŒ–å»¶è¿Ÿ': '设备初始化延迟',
    'è®¾å¤‡å¯å§‹åŒ–è¶…æ—¶': '设备初始化超时',
    'è®¾å¤‡å¯å§‹åŒ–ç­‰å¾…': '设备初始化等待',
    'è®¾å¤‡å¯å§‹åŒ–æš‚åœ': '设备初始化暂停',
    'è®¾å¤‡å¯å§‹åŒ–æ¢å¤': '设备初始化恢复',
    'è®¾å¤‡å¯å§‹åŒ–ç»§ç»­': '设备初始化继续',
    'è®¾å¤‡å¯å§‹åŒ–ä¸­æ–­': '设备初始化中断',
    'è®¾å¤‡å¯å§‹åŒ–ç»ˆæ­¢': '设备初始化终止',
    'è®¾å¤‡å¯å§‹åŒ–å…³é—­': '设备初始化关闭',
    'è®¾å¤‡å¯å§‹åŒ–é€€å‡º': '设备初始化退出',
    'è®¾å¤‡å¯å§‹åŒ–é‡Šæ”¾': '设备初始化释放',
    'è®¾å¤‡å¯å§‹åŒ–é”€æ¯': '设备初始化销毁',
    'è®¾å¤‡å¯å§‹åŒ–æ¸…ç†': '设备初始化清理',
    'è®¾å¤‡å¯å§‹åŒ–å›žæ”¶': '设备初始化回收',
    'è®¾å¤‡å¯å§‹åŒ–åžƒåœ¾': '设备初始化垃圾',
    'è®¾å¤‡å¯å§‹åŒ–å†…å­˜': '设备初始化内存',
    'è®¾å¤‡å¯å§‹åŒ–ç¡¬ç›˜': '设备初始化硬盘',
    'è®¾å¤‡å¯å§‹åŒ–CPU': '设备初始化CPU',
    'è®¾å¤‡å¯å§‹åŒ–GPU': '设备初始化GPU',
    'è®¾å¤‡å¯å§‹åŒ–ç½‘ç»œ': '设备初始化网络',
    'è®¾å¤‡å¯å§‹åŒ–æ•°æ®åº“': '设备初始化数据库',
    'è®¾å¤‡å¯å§‹åŒ–ç¼“å­˜': '设备初始化缓存',
    'è®¾å¤‡å¯å§‹åŒ–æ—¥å¿—': '设备初始化日志',
    'è®¾å¤‡å¯å§‹åŒ–è°ƒè¯•': '设备初始化调试',
    'è®¾å¤‡å¯å§‹åŒ–æµ‹è¯•': '设备初始化测试',
    'è®¾å¤‡å¯å§‹åŒ–éƒ¨ç½²': '设备初始化部署',
    'è®¾å¤‡å¯å§‹åŒ–é…ç½®': '设备初始化配置',
    'è®¾å¤‡å¯å§‹åŒ–çŽ¯å¢ƒ': '设备初始化环境',
    'è®¾å¤‡å¯å§‹åŒ–å‚æ•°': '设备初始化参数',
    'è®¾å¤‡å¯å§‹åŒ–å˜é‡': '设备初始化变量',
    'è®¾å¤‡å¯å§‹åŒ–å¸¸é‡': '设备初始化常量',
    'è®¾å¤‡å¯å§‹åŒ–å‡½æ•°': '设备初始化函数',
    'è®¾å¤‡å¯å§‹åŒ–æ–¹æ³•': '设备初始化方法',
    'è®¾å¤‡å¯å§‹åŒ–ç±»': '设备初始化类',
    'è®¾å¤‡å¯å§‹åŒ–å¯¹è±¡': '设备初始化对象',
    'è®¾å¤‡å¯å§‹åŒ–å®žä¾‹': '设备初始化实例',
    'è®¾å¤‡å¯å§‹åŒ–å±žæ€§': '设备初始化属性',
    'è®¾å¤‡å¯å§‹åŒ–æˆå‘˜': '设备初始化成员',
    'è®¾å¤‡å¯å§‹åŒ–å­—æ®µ': '设备初始化字段',
    'è®¾å¤‡å¯å§‹åŒ–æ ‡ç­¾': '设备初始化标签',
    'è®¾å¤‡å¯å§‹åŒ–æ³¨é‡Š': '设备初始化注释',
    'è®¾å¤‡å¯å§‹åŒ–æ–‡æ¡£': '设备初始化文档',
    'è®¾å¤‡å¯å§‹åŒ–å¥åº·æ£€æŸ¥': '设备初始化健康检查',
    'è®¾å¤‡å¯å§‹åŒ–çŠ¶æ€æ£€æŸ¥': '设备初始化状态检查',
    'è®¾å¤‡å¯å§‹åŒ–æ€§èƒ½æ£€æŸ¥': '设备初始化性能检查',
    'è®¾å¤‡å¯å§‹åŒ–å®‰å…¨æ£€æŸ¥': '设备初始化安全检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç”¨æ€§æ£€æŸ¥': '设备初始化可用性检查',
    'è®¾å¤‡å¯å§‹åŒ–å®Œæ•´æ€§æ£€æŸ¥': '设备初始化完整性检查',
    'è®¾å¤‡å¯å§‹åŒ–ä¸€è‡´æ€§æ£€æŸ¥': '设备初始化一致性检查',
    'è®¾å¤‡å¯å§‹åŒ–å‡†ç¡®æ€§æ£€æŸ¥': '设备初始化准确性检查',
    'è®¾å¤‡å¯å§‹åŒ–æœ‰æ•ˆæ€§æ£€æŸ¥': '设备初始化有效性检查',
    'è®¾å¤‡å¯å§‹åŒ–åˆæ³•æ€§æ£€æŸ¥': '设备初始化合法性检查',
    'è®¾å¤‡å¯å§‹åŒ–å®¹é”™æ€§æ£€æŸ¥': '设备初始化容错性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æµæ€§æ£€æŸ¥': '设备初始化可恢复性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æ‰©å±•æ€§æ£€æŸ¥': '设备初始化可扩展性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç»´æŠ¤æ€§æ£€æŸ¥': '设备初始化可维护性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é…ç½®æ€§æ£€æŸ¥': '设备初始化可配置性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç®¡ç†æ€§æ£€æŸ¥': '设备初始化可管理性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç›‘æŽ§æ€§æ£€æŸ¥': '设备初始化可监控性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è¿½è¸ªæ€§æ£€æŸ¥': '设备初始化可追溯性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æµ‹è¯•æ€§æ£€æŸ¥': '设备初始化可测试性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è°ƒè¯•æ€§æ£€æŸ¥': '设备初始化可调试性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯éƒ¨ç½²æ€§æ£€æŸ¥': '设备初始化可部署性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é›†æˆæ€§æ£€æŸ¥': '设备初始化可集成性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯äº¤äº’æ€§æ£€æŸ¥': '设备初始化可交互性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è§†åŒ–æ€§æ£€æŸ¥': '设备初始化可视化检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æ“ä½œæ€§æ£€æŸ¥': '设备初始化可操作性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç†è§£æ€§æ£€æŸ¥': '设备初始化可理解性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç”¨æ€§æ£€æŸ¥': '设备初始化可用性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é æ€§æ£€æŸ¥': '设备初始化可靠性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç¨³å®šæ€§æ£€æŸ¥': '设备初始化稳定性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æŒç»­æ€§æ£€æŸ¥': '设备初始化持续性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ä¿¡ä»»æ€§æ£€æŸ¥': '设备初始化可信性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é¢„æµ‹æ€§æ£€æŸ¥': '设备初始化可预测性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æŽ§æ€§æ£€æŸ¥': '设备初始化可控性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è§‚æµ‹æ€§æ£€æŸ¥': '设备初始化可观测性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è°ƒåº¦æ€§æ£€æŸ¥': '设备初始化可调度性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç®¡ç†æ€§æ£€æŸ¥': '设备初始化可管理性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç›‘æŽ§æ€§æ£€æŸ¥': '设备初始化可监控性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è¿½è¸ªæ€§æ£€æŸ¥': '设备初始化可追溯性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æµ‹è¯•æ€§æ£€æŸ¥': '设备初始化可测试性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è°ƒè¯•æ€§æ£€æŸ¥': '设备初始化可调试性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯éƒ¨ç½²æ€§æ£€æŸ¥': '设备初始化可部署性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é›†æˆæ€§æ£€æŸ¥': '设备初始化可集成性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯äº¤äº’æ€§æ£€æŸ¥': '设备初始化可交互性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è§†åŒ–æ€§æ£€æŸ¥': '设备初始化可视化检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æ“ä½œæ€§æ£€æŸ¥': '设备初始化可操作性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç†è§£æ€§æ£€æŸ¥': '设备初始化可理解性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç”¨æ€§æ£€æŸ¥': '设备初始化可用性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é æ€§æ£€æŸ¥': '设备初始化可靠性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ç¨³å®šæ€§æ£€æŸ¥': '设备初始化稳定性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æŒç»­æ€§æ£€æŸ¥': '设备初始化持续性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯ä¿¡ä»»æ€§æ£€æŸ¥': '设备初始化可信性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯é¢„æµ‹æ€§æ£€æŸ¥': '设备初始化可预测性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯æŽ§æ€§æ£€æŸ¥': '设备初始化可控性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è§‚æµ‹æ€§æ£€æŸ¥': '设备初始化可观测性检查',
    'è®¾å¤‡å¯å§‹åŒ–å¯è°ƒåº¦æ€§æ£€æŸ¥': '设备初始化可调度性检查',
}

def load_translation_keys():
    """加载翻译键"""
    if not os.path.exists(CHINESE_STRINGS_PATH):
        print(f"警告: 未找到翻译键文件 {CHINESE_STRINGS_PATH}")
        return {}
    
    translation_keys = {}
    with open(CHINESE_STRINGS_PATH, 'r', encoding='utf-8') as f:
        for line in f:
            line = line.strip()
            if line and ':' in line:
                chinese, key = line.split(':', 1)
                translation_keys[chinese.strip()] = key.strip()
    
    return translation_keys

def fix_lang_js_garbled():
    """修复lang.js中的乱码"""
    if not os.path.exists(LANG_JS_PATH):
        print(f"错误: 未找到文件 {LANG_JS_PATH}")
        return
    
    with open(LANG_JS_PATH, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 应用乱码映射
    original_content = content
    for garbled, correct in GARBLED_MAPPINGS.items():
        if garbled in content:
            print(f"修复乱码: '{garbled}' -> '{correct}'")
            content = content.replace(garbled, correct)
    
    # 如果有修改，则写入文件
    if content != original_content:
        with open(LANG_JS_PATH, 'w', encoding='utf-8') as f:
            f.write(content)
        print("lang.js乱码修复完成")
    else:
        print("lang.js中未发现需要修复的乱码")

def fix_index_html_hardcoded():
    """替换index.html中的硬编码中文"""
    if not os.path.exists(INDEX_HTML_PATH):
        print(f"错误: 未找到文件 {INDEX_HTML_PATH}")
        return
    
    with open(INDEX_HTML_PATH, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 加载翻译键
    translation_keys = load_translation_keys()
    
    # 需要替换的硬编码中文模式
    patterns = [
        (r'alert\s*\(\s*[\'\"]([^\'\"]*)[\'\"]\s*\)', 'alert'),
        (r'prompt\s*\(\s*[\'\"]([^\'\"]*)[\'\"]\s*\)', 'prompt'),
        (r'confirm\s*\(\s*[\'\"]([^\'\"]*)[\'\"]\s*\)', 'confirm')
    ]
    
    modified = False
    for pattern, func_name in patterns:
        matches = re.finditer(pattern, content)
        for match in matches:
            full_match = match.group(0)
            chinese_text = match.group(1)
            
            # 如果文本包含中文
            if re.search(r'[\u4e00-\u9fff]', chinese_text):
                # 查找对应的翻译键
                translation_key = translation_keys.get(chinese_text)
                if translation_key:
                    # 替换为getTranslation调用
                    replacement = f'{func_name}(getTranslation("{translation_key}"))'
                    content = content.replace(full_match, replacement)
                    print(f"替换硬编码文本: '{chinese_text}' -> '{replacement}'")
                    modified = True
                else:
                    print(f"警告: 未找到翻译键 for '{chinese_text}'")
    
    # 如果有修改，则写入文件
    if modified:
        with open(INDEX_HTML_PATH, 'w', encoding='utf-8') as f:
            f.write(content)
        print("index.html硬编码中文修复完成")
    else:
        print("index.html中未发现需要修复的硬编码中文")

def update_lang_js_translations():
    """更新lang.js中的翻译定义"""
    if not os.path.exists(LANG_JS_PATH):
        print(f"错误: 未找到文件 {LANG_JS_PATH}")
        return
    
    # 加载翻译键
    translation_keys = load_translation_keys()
    if not translation_keys:
        print("错误: 未加载到翻译键")
        return
    
    with open(LANG_JS_PATH, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 为每个翻译键创建或更新定义
    modified = False
    for chinese, key in translation_keys.items():
        # 检查是否已存在该键的定义
        pattern = rf'{key}\s*:'
        if not re.search(pattern, content):
            # 如果不存在，则添加定义（这里简化处理，实际应该更精确地定位插入位置）
            # 查找translations对象的结束位置
            match = re.search(r'(const\s+translations\s*=\s*\{)', content)
            if match:
                insert_pos = match.end()
                # 插入新的翻译定义
                new_definition = f"\n  {key}: \"{chinese}\","
                content = content[:insert_pos] + new_definition + content[insert_pos:]
                print(f"添加翻译定义: {key} -> {chinese}")
                modified = True
    
    # 如果有修改，则写入文件
    if modified:
        with open(LANG_JS_PATH, 'w', encoding='utf-8') as f:
            f.write(content)
        print("lang.js翻译定义更新完成")
    else:
        print("lang.js翻译定义无需更新")

def main():
    """主函数"""
    print("开始执行增强版修复...")
    
    # 修复lang.js中的乱码
    fix_lang_js_garbled()
    
    # 替换index.html中的硬编码中文
    fix_index_html_hardcoded()
    
    # 更新lang.js中的翻译定义
    update_lang_js_translations()
    
    print("增强版修复执行完成")

if __name__ == "__main__":
    main()