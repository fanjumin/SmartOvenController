#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import shutil
from datetime import datetime

def fix_chinese_encoding_simple():
    """
    简单中文编码修复函数，使用已知的乱码映射
    """
    # 创建备份
    html_file = 'data/index.html'
    backup_path = f'data/index.html.simple_backup_{datetime.now().strftime("%Y%m%d_%H%M%S")}'
    shutil.copy(html_file, backup_path)
    print(f"已备份原文件到: {backup_path}")
    
    # 读取文件内容
    with open(html_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 已知的乱码映射
    fixes = {
        'æ™ºèƒ½çƒ¤ç®±': '智能烤箱',
        'ç®¡ç†': '管理',
        'å‘˜æŽ§åˆ¶é¢': '员控制面',
        'æ¿åº¦': '温度',
        'åº¦': '度',
        'æ—¶é—´': '时间',
        'åŠ çƒ­': '加热',
        'åœ¨çº¿': '在线',
        'çŠ¶æ€': '状态',
        'è¿žæŽ¥': '连接',
        'è®¾å¤‡': '设备',
        'å¼€å§‹': '开始',
        'åœæ­¢': '停止',
        'èŽ·å–': '获取',
        'è¾“å…¥': '输入',
        'è®¾ç½®': '设置',
        'ä¿å­˜': '保存',
        'é€€å‡º': '退出',
        'ç™»å½•': '登录',
        'ä¿®æ”¹å¯†ç ': '修改密码',
        'é…è½½': '配置',
        'ç½‘ç»œ': '网络',
        'ä¿¡å·': '信号',
        'å›ºä»¶æ›´æ–°': '固件更新',
        'é‡è½½': '重载',
        'å¤±è´¥': '失败',
        'æˆæ•': '成功',
        'è¯·è¾“å…¥': '请输入',
        'ç¡®è®¤': '确认',
        'æ–°å¯†ç ': '新密码',
        'å½“å‰å¯†ç ': '当前密码',
        'ä¸€è‡´': '一致',
        'èŒƒå›´': '范围',
        'åº”ä¸º': '应为',
        'åˆ†é’Ÿ': '分钟',
        'è‡ªåŠ¨æ¨¡å¼': '自动模式',
        'æ‰‹åŠ¨æ¨¡å¼': '手动模式',
        'è°ƒèŠ‚': '调节',
        'é»˜è®¤å€¼': '默认值',
        'é›¶å€¼': '零值',
        'å·¥ä½œ': '工作',
        'å…³é—­': '关闭',
        'æ­£å¸¸': '正常',
        'æœªèŽ·å¾—': '未获得',
        'çœŸå®ž': '真实',
        'å¯ç”¨': '可用',
        'ä¸å¯ç”¨': '不可用',
        'é”™è¯¯': '错误',
        'ç³»ç»Ÿ': '系统',
        'ç›‘æŽ§': '监控',
        'ä¿¡æ¯': '信息',
        'æ•°æ®': '数据',
        'åˆ·æ–°': '刷新',
        'è¯¥åŠŸèƒ½': '该功能',
        'å·²åŠ è½½': '已加载',
        'è¯·ç­‰å¾…': '请等待',
        'çº¦ç§’': '约秒',
        'é‡è¿žæŽ¥': '重连接',
        'æ¢æ复å‡ºåŽ‚è®¾ç½®': '恢复出厂设置',
        'æ¸…é™¤': '清除',
        'é‡è½½': '重载',
        'æœ¬åœ°': '本地',
        'è¿œç¨‹': '远程',
        'æŽ§åˆ¶': '控制',
        'å‘½ä»¤': '命令',
        'å‘é€': '发送',
        'æŽ¥æ”¶': '接收',
        'å“åº”': '响应',
        'è¶…æ—¶': '超时',
        'æ— æ•ˆ': '无效',
        'æœ‰æ•ˆ': '有效',
        'å¯ç”¨': '可用',
        'ç¦ç”¨': '禁用',
        'å¯è§': '可见',
        'éšè—': '隐藏',
        'æ˜¾ç¤º': '显示',
        'éšè—': '隐藏',
        'å¯è§': '可见',
        'ç¦ç”¨': '禁用',
        'é‡è¿žæŽ¥': '重连接',
        'é‡è½½': '重载',
        'çº¦': '约',
        'é’Ÿ': '钟',
        'é‡è¿žæŽ¥': '重连接',
        'è®¾å¤‡': '设备',
        'æ­£åœ¨é‡è½½': '正在重载',
        'åŠ è½½ä¸­': '加载中',
        'è¿žæŽ¥ä¸­': '连接中',
        'ç­‰å¾…': '等待',
        'å®Œæˆ': '完成',
        'å¼€å§‹': '开始',
        'æš‚å': '暂',
        'ç»\ue195': '置',
        'è®¾\ue62c': '设备',
        'ç»\ue1bc': '置',
        'è®¾\ue11d': '操',
        'æ\ue632': '恢',
        'è®¾\ue044': '自',
        'é\ue21d\ue195': '置',
        'é\ue195': '置',
        'é\ue62c': '备',
        'é\ue1bc': '置',
        'é\ue11d': '操',
        'é\ue632': '恢',
        'é\ue044': '自',
        'ç\ue11d': '操',
        'ç\ue1bc': '置',
        'ç\ue195': '置',
        'ç\ue044': '自',
        'æ\ue21d\ue195': '置',
        'æ\ue195': '置',
        'æ\ue62c': '备',
        'æ\ue1bc': '置',
        'æ\ue11d': '操',
        'æ\ue632': '恢',
        'æ\ue044': '自',
        'é‡è¿žæŽ¥': '重连接',
        'é‡è½½': '重载',
        'çº¦': '约',
        'é’Ÿ': '钟',
        'é‡è¿žæŽ¥': '重连接',
        'è®¾å¤‡': '设备',
        'æ­£åœ¨é‡è½½': '正在重载',
        'åŠ è½½ä¸­': '加载中',
        'è¿žæŽ¥ä¸­': '连接中',
        'ç­‰å¾…': '等待',
        'å®Œæˆ': '完成',
        'å¼€å§‹': '开始',
        'æš‚å': '暂',
        'é‡è¿žæŽ¥': '重连接',
        'é‡è½½': '重载',
        'çº¦': '约',
        'é’Ÿ': '钟',
        'è®¾å¤‡': '设备',
        'åŠ è½½ä¸­': '加载中',
        'è¿žæŽ¥ä¸­': '连接中',
        'ç­‰å¾…': '等待',
        'å®Œæˆ': '完成',
        'å¼€å§‹': '开始',
        'æš‚å': '暂',
        'ç»\ue62c': '备',
        'é\ue21d\ue195': '置',
        'é\ue195': '置',
        'é\ue62c': '备',
        'é\ue1bc': '置',
        'é\ue11d': '操',
        'é\ue632': '恢',
        'é\ue044': '自',
        'ç\ue11d': '操',
        'ç\ue1bc': '置',
        'ç\ue195': '置',
        'ç\ue044': '自',
        'æ\ue21d\ue195': '置',
        'æ\ue195': '置',
        'æ\ue62c': '备',
        'æ\ue1bc': '置',
        'æ\ue11d': '操',
        'æ\ue632': '恢',
        'æ\ue044': '自',
        'ç»\ue195': '置',
        'è®¾\ue62c': '设备',
        'ç»\ue1bc': '置',
        'è®¾\ue11d': '操',
        'æ\ue632': '恢',
        'è®¾\ue044': '自',
        'ç»\ue62c': '备',
        'ç»\ue1bc': '置',
        'ç»\ue11d': '操',
        'ç»\ue632': '恢',
        'ç»\ue044': '自',
        'æ\ue195': '置',
        'æ\ue62c': '备',
        'æ\ue1bc': '置',
        'æ\ue11d': '操',
        'æ\ue632': '恢',
        'æ\ue044': '自'
    }
    
    # 应用替换
    for bad_text, good_text in fixes.items():
        content = content.replace(bad_text, good_text)
    
    # 特殊处理标题
    content = content.replace('ç»\ue195èƒ½çƒ¤ç®± - ç®¡ç»\ue195å‘˜æŽ§åˆ¶é¢\ue192', '智能烤箱 - 管理员控制面板')
    content = content.replace('ç»\ue195èƒ½çƒ¤ç®±', '智能烤箱')
    content = content.replace('ç®¡ç»\ue195å‘˜æŽ§åˆ¶é¢\ue192', '管理员控制面板')
    
    # 写回文件（UTF-8编码）
    with open(html_file, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("HTML文件简单编码修复完成")
    
    # 修复lang.js文件
    lang_file = 'data/lang.js'
    lang_backup_path = f'data/lang.js.simple_backup_{datetime.now().strftime("%Y%m%d_%H%M%S")}'
    shutil.copy(lang_file, lang_backup_path)
    print(f"已备份原lang.js文件到: {lang_backup_path}")
    
    # 读取lang.js文件
    with open(lang_file, 'r', encoding='utf-8') as f:
        lang_content = f.read()
    
    # 应用相同的替换
    for bad_text, good_text in fixes.items():
        lang_content = lang_content.replace(bad_text, good_text)
    
    # 写回文件（UTF-8编码）
    with open(lang_file, 'w', encoding='utf-8') as f:
        f.write(lang_content)
    
    print("lang.js文件简单编码修复完成")
    print("简单编码修复完成!")

if __name__ == "__main__":
    fix_chinese_encoding_simple()