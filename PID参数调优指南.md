# PID参数调优指南

## PID控制原理

PID控制器由三个部分组成：
- **比例(P)项**: 响应当前误差，决定响应速度
- **积分(I)项**: 累积历史误差，消除稳态误差
- **微分(D)项**: 预测未来趋势，抑制超调

### 控制公式
```
输出 = Kp × 误差 + Ki × ∫误差·dt + Kd × d(误差)/dt
```

## 参数调优方法

### 1. 手动调优步骤

#### 第一步：只使用P控制
1. 设置 Ki = 0, Kd = 0
2. 逐渐增加Kp直到系统开始振荡
3. 将Kp设置为振荡临界值的50-60%

#### 第二步：加入I控制
1. 保持Kd = 0
2. 逐渐增加Ki直到稳态误差消除
3. 注意Ki过大会导致系统不稳定

#### 第三步：加入D控制
1. 逐渐增加Kd来抑制超调
2. Kd过大会放大噪声
3. 通常Kd设置为Kp的0.1-0.5倍

### 2. 电烤箱推荐参数

| 温度范围 | Kp | Ki | Kd | 说明 |
|----------|-----|-----|-----|------|
| 50-150°C | 1.5 | 0.05 | 0.5 | 低温区，响应较慢 |
| 150-250°C | 2.0 | 0.1 | 1.0 | 中温区，平衡响应 |
| 250-300°C | 2.5 | 0.15 | 1.5 | 高温区，需要更快响应 |

### 3. Ziegler-Nichols方法

#### 第一步：确定临界增益
1. 设置 Ki = 0, Kd = 0
2. 逐渐增加Kp直到系统持续振荡
3. 记录临界增益Kc和振荡周期Tc

#### 第二步：计算参数
- **P控制**: Kp = 0.5 × Kc
- **PI控制**: Kp = 0.45 × Kc, Ki = 1.2 × Kp / Tc
- **PID控制**: Kp = 0.6 × Kc, Ki = 2 × Kp / Tc, Kd = Kp × Tc / 8

## 常见问题及解决方案

### 1. 系统振荡
**症状**: 温度在目标值上下波动
**原因**: Kp过大或Kd过小
**解决**: 减小Kp或增加Kd

### 2. 响应过慢
**症状**: 温度上升缓慢
**原因**: Kp过小
**解决**: 适当增加Kp

### 3. 超调过大
**症状**: 温度超过目标值较多
**原因**: Kp过大或Kd过小
**解决**: 减小Kp或增加Kd

### 4. 稳态误差
**症状**: 温度无法达到目标值
**原因**: Ki过小
**解决**: 适当增加Ki

## 高级调优技巧

### 1. 自适应PID
根据温度误差大小动态调整参数：
- 大误差时：使用较大的Kp快速响应
- 小误差时：使用较小的Kp避免振荡

### 2. 抗饱和处理
积分项饱和会导致系统响应变慢：
- 设置积分限幅
- 当输出饱和时停止积分

### 3. 微分先行
只对测量值进行微分，不对设定值微分：
- 减少设定值变化时的冲击
- 提高系统稳定性

## 调试工具

### 串口监视器
通过串口输出实时数据：
```
温度: 180.5°C, 目标: 200.0°C, 误差: -19.5°C, PID输出: 45.2%, 模式: PID
```

### Web界面监控
实时查看：
- 当前温度和目标温度
- PID输出百分比
- 继电器状态
- 控制模式

## 安全注意事项

### 调优安全
1. **从小参数开始**: 避免参数过大导致系统失控
2. **逐步调整**: 每次只调整一个参数
3. **观察响应**: 每次调整后观察系统响应
4. **温度限制**: 设置温度上限保护

### 硬件保护
1. **温度传感器**: 确保热电偶安装正确
2. **固态继电器**: 配备足够散热片
3. **电源保护**: 使用合适的保险丝

## 性能指标

### 理想响应特性
- **上升时间**: 2-5分钟达到目标温度
- **超调量**: < 5%
- **稳定时间**: < 10分钟
- **稳态误差**: < 1°C

### 实际测试方法
1. 设置目标温度200°C
2. 记录从启动到稳定的全过程
3. 分析响应曲线
4. 根据结果调整参数

## 故障排除

### PID不工作
1. 检查usePID标志是否为true
2. 验证PID计算函数是否被调用
3. 检查串口输出是否有PID相关信息

### 温度控制不稳定
1. 检查热电偶连接是否牢固
2. 验证MAX6675读数是否准确
3. 检查固态继电器工作状态

---

**提示**: PID调优需要耐心和经验，建议先用开关控制模式熟悉系统特性，再逐步切换到PID控制。