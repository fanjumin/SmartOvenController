# OTA（空中下载）升级指南

## 概述

OTA（Over-The-Air）升级功能允许您通过网络远程更新设备固件，无需通过串口连接。本指南详细说明如何通过OTA实现设备版本升级。

## 设备端OTA功能

### 当前实现的OTA功能

设备固件（v0.4.0）已包含完整的OTA升级功能：

1. **OTA服务器**：运行在端口8080，支持HTTP固件上传
2. **Web界面**：通过`/ota`路径访问用户友好的升级界面
3. **版本检查**：通过`/checkupdate`API检查当前固件版本
4. **自动重启**：升级完成后设备自动重启应用新固件

### OTA升级页面功能

访问设备IP地址的`/ota`页面（如：`http://192.168.1.100/ota`）可看到：

- 设备信息显示（IP地址、固件版本）
- 固件文件上传界面
- 升级进度显示
- 升级结果反馈

## 安卓APP OTA功能

### 新增的OTA功能

安卓APP（v0.1.0）已添加OTA相关功能：

1. **菜单入口**：右上角菜单包含"OTA升级"和"检查更新"选项
2. **设备连接检测**：自动检测设备连接状态
3. **浏览器集成**：直接打开设备OTA升级页面
4. **版本信息**：显示设备和APP版本信息

### 使用步骤

1. **连接设备**：确保APP已连接到目标设备
2. **打开菜单**：点击右上角菜单按钮
3. **选择OTA升级**：点击"OTA升级"菜单项
4. **访问升级页面**：APP会自动打开设备的OTA升级页面
5. **上传固件**：选择新的固件文件并开始升级

## OTA升级操作流程

### 准备工作

1. **固件文件准备**：
   - 编译生成新的`.bin`固件文件
   - 确保固件版本号正确（如v0.4.1）
   - 验证固件功能正常

2. **网络环境**：
   - 确保设备和手机在同一WiFi网络
   - 确认设备IP地址可达
   - 检查网络稳定性

### 升级步骤

#### 方法一：通过安卓APP升级

1. 打开智能电烤箱控制器APP
2. 扫描并连接到目标设备
3. 点击右上角菜单 → "OTA升级"
4. 系统浏览器会自动打开设备OTA页面
5. 点击"选择文件"按钮选择固件文件
6. 点击"开始升级"按钮
7. 等待升级完成（约1-3分钟）
8. 设备自动重启后验证新功能

#### 方法二：直接浏览器访问

1. 获取设备IP地址（可通过APP查看）
2. 在浏览器中输入：`http://[设备IP]:8080/update`
3. 或访问：`http://[设备IP]/ota`（推荐）
4. 选择固件文件并开始升级

### 升级注意事项

1. **电源稳定**：升级过程中确保设备供电稳定
2. **网络稳定**：避免升级过程中网络中断
3. **文件验证**：确保固件文件完整且正确
4. **备份配置**：重要配置建议提前备份
5. **测试验证**：升级完成后全面测试设备功能

## 故障排除

### 常见问题

1. **无法访问OTA页面**
   - 检查设备IP地址是否正确
   - 确认设备和手机在同一网络
   - 重启设备后重试

2. **升级失败**
   - 检查固件文件是否损坏
   - 确认固件版本兼容性
   - 查看设备串口日志获取错误信息

3. **升级后设备无响应**
   - 等待设备自动重启完成
   - 检查电源连接
   - 必要时通过串口恢复

### 紧急恢复

如果OTA升级失败导致设备无法使用：

1. **串口恢复**：通过USB转串口工具重新刷写固件
2. **工厂复位**：设备可能有硬件复位按钮
3. **版本回退**：刷写之前的稳定版本固件

## 安全考虑

1. **身份验证**：考虑为OTA页面添加密码保护
2. **固件签名**：实现固件数字签名验证
3. **网络隔离**：生产环境建议使用专用网络
4. **日志记录**：记录所有升级操作和结果

## 版本管理建议

1. **版本命名**：使用语义化版本号（如v1.2.3）
2. **变更日志**：详细记录每个版本的改进和修复
3. **测试流程**：建立完整的升级测试流程
4. **回滚计划**：准备版本回退方案

## 总结

通过OTA升级功能，您可以：

- ✅ 远程更新设备固件，无需物理连接
- ✅ 减少现场维护成本和时间
- ✅ 实现批量设备升级
- ✅ 快速修复问题和添加新功能
- ✅ 提供更好的用户体验

OTA升级是现代物联网设备的重要特性，大大提升了设备维护和功能更新的便利性。